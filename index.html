<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Sphere Arena</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>
<audio id="bgMusic" src="mingleboosted.mp3" loop autoplay></audio>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// --- Scene Setup ---
const scene = new THREE.Scene();

// Textured background
const loader = new THREE.TextureLoader();
loader.load('andy.gif', (texture) => {
  scene.background = texture;
});

// Camera
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 15, 30);

// Renderer
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);
scene.add(new THREE.AmbientLight(0x888888));

// Platform
const platformGeo = new THREE.BoxGeometry(50, 1, 50);
const platformMat = new THREE.MeshStandardMaterial({color:0x555555});
const platform = new THREE.Mesh(platformGeo, platformMat);
platform.position.y = 0;
scene.add(platform);

// Load textures
const playerTexture = loader.load('andyside.jpg');
const enemyTexture = loader.load('andyspin.jpg'); // assign different textures per enemy if you like

// Player sphere
const playerGeo = new THREE.SphereGeometry(2,32,32);
const playerMat = new THREE.MeshStandardMaterial({map: playerTexture});
const player = new THREE.Mesh(playerGeo, playerMat);
player.position.y = 2;
scene.add(player);

// Enemies
const enemies = [];
const enemyPositions = [
  [-10,2,-10],[10,2,-10],[-10,2,10],[10,2,10]
];
for(let i=0;i<enemyPositions.length;i++){
  const geo = new THREE.SphereGeometry(2,32,32);
  const mat = new THREE.MeshStandardMaterial({map: loader.load(`andyspin${i+1}.jpg`)});
  const enemy = new THREE.Mesh(geo, mat);
  enemy.position.set(enemyPositions[i][0],2,enemyPositions[i][2]);
  enemies.push(enemy);
  scene.add(enemy);
}

// Goal
const goalGeo = new THREE.BoxGeometry(4,1,4);
const goalMat = new THREE.MeshStandardMaterial({color:0xffd700});
const goal = new THREE.Mesh(goalGeo,goalMat);
goal.position.set(0,0.5,20);
scene.add(goal);

// Controls
const keys = {};
window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

let velocityY = 0;
const gravity = -0.3;
const speed = 0.3;
const jumpPower = 0.8;

// Simple collision detection (spheres)
function sphereCollision(a,b){
  const dx = a.position.x - b.position.x;
  const dy = a.position.y - b.position.y;
  const dz = a.position.z - b.position.z;
  const dist = Math.sqrt(dx*dx + dy*dy + dz*dz);
  return dist < 4; // radius sum 2+2
}

// Game loop
function animate(){
  requestAnimationFrame(animate);

  // Player movement
  if(keys['w']) player.position.z -= speed;
  if(keys['s']) player.position.z += speed;
  if(keys['a']) player.position.x -= speed;
  if(keys['d']) player.position.x += speed;

  // Jump
  if(keys[' ']){
    if(player.position.y <= 2.01){ // on ground
      velocityY = jumpPower;
    }
  }
  velocityY += gravity;
  player.position.y += velocityY;
  if(player.position.y < 2){ player.position.y = 2; velocityY=0; }

  // Enemy simple AI: move toward player
  for(let e of enemies){
    const dx = player.position.x - e.position.x;
    const dz = player.position.z - e.position.z;
    const dist = Math.sqrt(dx*dx + dz*dz);
    if(dist>0.1){
      e.position.x += (dx/dist)*0.1;
      e.position.z += (dz/dist)*0.1;
    }
  }

  // Collision player-enemies
  for(let e of enemies){
    if(sphereCollision(player,e)){
      // simple bounce
      const dirX = player.position.x - e.position.x;
      const dirZ = player.position.z - e.position.z;
      player.position.x += dirX*0.2;
      player.position.z += dirZ*0.2;
      e.position.x -= dirX*0.2;
      e.position.z -= dirZ*0.2;
    }
  }

  // Check win
  if(
    Math.abs(player.position.x - goal.position.x)<3 &&
    Math.abs(player.position.z - goal.position.z)<3
  ){
    alert("You Win!");
    window.location.reload();
  }

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
