<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sphere Arena Game with Textures</title>
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #222;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #444;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<audio id="bgMusic" src="mingleboosted.mp3" loop autoplay></audio>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const bgMusic = document.getElementById('bgMusic');
window.addEventListener('click', () => bgMusic.play(), { once: true });
window.addEventListener('touchstart', () => bgMusic.play(), { once: true });

// Load textures
const playerImg = new Image();
playerImg.src = 'andyside.jpg';

const enemyFrames = [];
for(let i=1;i<=4;i++){
    const img = new Image();
    img.src = `andyspin${i===1?'':i}.jpg`; // andyspin.jpg, andyspin2-4.jpg
    enemyFrames.push(img);
}

// Player sphere
const player = {
    x: canvas.width/2,
    y: canvas.height/2,
    radius: 30,
    vx: 0,
    vy: 0,
    speed: 5,
    img: playerImg
};

// AI spheres
const enemies = [];
const numEnemies = 5;
for(let i=0; i<numEnemies; i++){
    enemies.push({
        x: Math.random()*(canvas.width-60)+30,
        y: Math.random()*(canvas.height-60)+30,
        radius: 30,
        vx: 0,
        vy: 0,
        frame: Math.floor(Math.random()*enemyFrames.length),
        img: enemyFrames[Math.floor(Math.random()*enemyFrames.length)]
    });
}

// Goal
const goal = {
    x: canvas.width - 100,
    y: canvas.height/2,
    radius: 40,
    color: 'gold'
};

// Controls
const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// Collision detection
function collide(a,b){
    const dx = b.x - a.x;
    const dy = b.y - a.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < a.radius + b.radius){
        const angle = Math.atan2(dy, dx);
        const totalVx = a.vx - b.vx;
        const totalVy = a.vy - b.vy;
        a.vx = -totalVx * 0.5;
        a.vy = -totalVy * 0.5;
        b.vx = totalVx * 0.5;
        b.vy = totalVy * 0.5;

        const overlap = a.radius + b.radius - dist;
        a.x -= Math.cos(angle) * overlap/2;
        a.y -= Math.sin(angle) * overlap/2;
        b.x += Math.cos(angle) * overlap/2;
        b.y += Math.sin(angle) * overlap/2;
    }
}

// Update player
function updatePlayer(){
    if(keys['ArrowUp']) player.vy = -player.speed;
    else if(keys['ArrowDown']) player.vy = player.speed;
    else player.vy = 0;

    if(keys['ArrowLeft']) player.vx = -player.speed;
    else if(keys['ArrowRight']) player.vx = player.speed;
    else player.vx = 0;

    player.x += player.vx;
    player.y += player.vy;

    player.x = Math.max(player.radius, Math.min(canvas.width - player.radius, player.x));
    player.y = Math.max(player.radius, Math.min(canvas.height - player.radius, player.y));
}

// Update enemies
function updateEnemies(){
    for(let e of enemies){
        // Move towards player
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        e.vx = (dx/dist)*2;
        e.vy = (dy/dist)*2;

        e.x += e.vx;
        e.y += e.vy;

        // Bounce off walls
        if(e.x < e.radius || e.x > canvas.width - e.radius) e.vx *= -1;
        if(e.y < e.radius || e.y > canvas.height - e.radius) e.vy *= -1;

        // Animate frame
        e.frame = (e.frame+1)%enemyFrames.length;
        e.img = enemyFrames[e.frame];
    }
}

// Draw sphere with texture
function drawSphereTex(s){
    if(s.img.complete){
        ctx.drawImage(s.img, s.x - s.radius, s.y - s.radius, s.radius*2, s.radius*2);
    } else {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.radius, 0, Math.PI*2);
        ctx.fillStyle = s.color || 'white';
        ctx.fill();
        ctx.closePath();
    }
}

// Main game loop
function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw goal
    ctx.beginPath();
    ctx.arc(goal.x, goal.y, goal.radius,0,Math.PI*2);
    ctx.fillStyle = goal.color;
    ctx.fill();
    ctx.closePath();

    updatePlayer();
    updateEnemies();

    // Check collisions
    for(let e of enemies) collide(player,e);
    for(let i=0;i<enemies.length;i++){
        for(let j=i+1;j<enemies.length;j++){
            collide(enemies[i], enemies[j]);
        }
    }

    // Draw everything
    drawSphereTex(player);
    for(let e of enemies) drawSphereTex(e);

    // Check win
    const dx = goal.x - player.x;
    const dy = goal.y - player.y;
    if(Math.sqrt(dx*dx + dy*dy) < goal.radius + player.radius){
        alert('You Win!');
        window.location.reload();
    }

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
