<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Andy Sphere Sumo 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Courier New', monospace; }
        #ui {
            position: absolute; top: 20px; left: 20px; color: #0f0;
            text-shadow: 2px 2px 5px #000; font-size: 18px; pointer-events: none; z-index: 10; display: none;
        }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #000; z-index: 100; color: white;
        }
        #start-btn {
            padding: 25px 60px; font-size: 32px; cursor: pointer;
            background: #ff00ea; color: white; border: none; border-radius: 15px;
            font-weight: bold; box-shadow: 0 0 30px #ff00ea; text-transform: uppercase;
        }
    </style>
</head>
<body>

<div id="ui"><b>GOAL: REACH THE GOLDEN ANDY</b><br>WASD to Move | SPACE to Jump</div>

<div id="overlay">
    <h1 style="font-size: 50px; margin-bottom: 20px; color: #ff00ea;">ANDY SUMO</h1>
    <button id="start-btn">START GAME</button>
</div>

<audio id="music" loop preload="auto"><source src="./mingleboosted.mp3"></audio>

<script type="importmap">
    { "imports": { "three": "https://unpkg.com" } }
</script>

<script type="module">
import * as THREE from 'three';

let scene, camera, renderer, player, goal, started = false;
let enemies = [];
const keys = {};
const loader = new THREE.TextureLoader();
loader.setCrossOrigin('anonymous');

// Texture assets (Relative paths for GitHub Pages)
const textures = {
    andy1: loader.load('./andyspin.jpg'),
    andy2: loader.load('./andyspin2.jpg'),
    andy3: loader.load('./andyspin3.jpg'),
    andy4: loader.load('./andyspin4.jpg'),
    side: loader.load('./andyside.jpg'),
    gif: loader.load('./andyvid.gif')
};

const startBtn = document.getElementById('start-btn');

function initGame() {
    scene = new THREE.Scene();
    
    // 1. SKYBOX (Andy Universe)
    const skyMats = [
        new THREE.MeshBasicMaterial({ map: textures.gif, side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: textures.andy2, side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: textures.gif, side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: textures.andy3, side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: textures.andy4, side: THREE.BackSide }),
        new THREE.MeshBasicMaterial({ map: textures.side, side: THREE.BackSide })
    ];
    const sky = new THREE.Mesh(new THREE.BoxGeometry(1000, 1000, 1000), skyMats);
    scene.add(sky);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 3.5));

    // 2. PLATFORM (The Arena)
    const platMat = new THREE.MeshStandardMaterial({ map: textures.side });
    for (let z = 0; z < 45; z++) {
        for (let x = 0; x < 5; x++) {
            if ((x + z) % 11 === 0) continue; // Holes
            const tile = new THREE.Mesh(new THREE.BoxGeometry(10, 2, 10), platMat);
            tile.position.set(x * 11 - 22, 0, z * -14 + 10);
            scene.add(tile);
        }
    }

    // 3. PLAYER SPHERE
    player = new THREE.Mesh(new THREE.SphereGeometry(1.6, 32, 32), new THREE.MeshStandardMaterial({ map: textures.andy1 }));
    player.position.set(0, 10, 30);
    player.velocity = new THREE.Vector3();
    scene.add(player);

    // 4. ENEMIES (Andy Bots)
    const enTex = [textures.andy2, textures.andy3, textures.andy4];
    for(let i = 0; i < 25; i++) {
        let enemy = new THREE.Mesh(new THREE.SphereGeometry(1.7, 32, 32), new THREE.MeshStandardMaterial({ map: enTex[i % 3] }));
        enemy.position.set(Math.random() * 100 - 50, 2, Math.random() * -450);
        enemy.velocity = new THREE.Vector3();
        enemies.push(enemy);
        scene.add(enemy);
    }

    // 5. THE GOLDEN ANDY
    goal = new THREE.Mesh(new THREE.SphereGeometry(8, 64, 64), new THREE.MeshStandardMaterial({ color: 0xffd700, emissive: 0xaa8800 }));
    goal.position.set(0, 4, -580);
    scene.add(goal);

    animate();
}

function physics(obj, isPlayer) {
    const drag = 0.985;
    const gravity = -0.02;

    if (isPlayer && started) {
        const pSpeed = 0.12;
        if (keys['w']) obj.velocity.z -= pSpeed;
        if (keys['s']) obj.velocity.z += pSpeed;
        if (keys['a']) obj.velocity.x -= pSpeed;
        if (keys['d']) obj.velocity.x += pSpeed;
        if (keys[' '] && obj.position.y < 1.7) obj.velocity.y = 0.6;
    }

    obj.velocity.y += gravity;
    obj.velocity.x *= drag; obj.velocity.z *= drag;
    obj.position.add(obj.velocity);

    // Floor collision
    if (obj.position.y < 1.6 && obj.position.y > -2) {
        if (Math.abs(obj.position.x) < 70 && obj.position.z < 50 && obj.position.z > -650) {
            obj.position.y = 1.6;
            obj.velocity.y = 0;
        }
    }
    
    // Death reset
    if (obj.position.y < -60) {
        obj.position.set(isPlayer ? 0 : Math.random() * 60 - 30, 25, isPlayer ? 30 : -150);
        obj.velocity.set(0, 0, 0);
    }
}

function animate() {
    requestAnimationFrame(animate);
    physics(player, true);

    enemies.forEach(en => {
        const dir = new THREE.Vector3().subVectors(player.position, en.position).normalize();
        en.velocity.add(dir.multiplyScalar(0.025));
        physics(en, false);

        if (player.position.distanceTo(en.position) < 3.4) {
            const force = new THREE.Vector3().subVectors(player.position, en.position).normalize();
            player.velocity.add(force.multiplyScalar(0.9));
            en.velocity.add(force.multiplyScalar(-0.9));
        }
    });

    camera.position.lerp(new THREE.Vector3(player.position.x, player.position.y + 15, player.position.z + 28), 0.15);
    camera.lookAt(player.position);

    if (player.position.distanceTo(goal.position) < 12) {
        alert("YOU HAVE REACHED THE MYTHICAL ANDY!");
        player.position.set(0, 25, 30);
        player.velocity.set(0, 0, 0);
    }
    renderer.render(scene, camera);
}

// ACTION BUTTON
startBtn.addEventListener('click', () => {
    // Start Audio
    document.getElementById('music').play().catch(() => {});
    
    // Lock Pointer
    document.body.requestPointerLock = document.body.requestPointerLock || document.body.mozRequestPointerLock || document.body.webkitRequestPointerLock;
    document.body.requestPointerLock();
    
    // Hide UI & Start
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('ui').style.display = 'block';
    
    started = true;
    initGame();
});

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
window.addEventListener('resize', () => {
    if(renderer) {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
});
</script>
</body>
</html>
